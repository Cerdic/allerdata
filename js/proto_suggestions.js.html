#HTTP_HEADER{'Content-Type: application/x-javascript'}
/* --------------------------------- Produits associés aux RC ------------------------------------- */

var LISTE_DES_SUGGESTIONS = {
  
  grid : null,
  
  init : function(){},
  
  getPanel : function(){

    if (!this.grid) {
          
      var center = function(texte) {
        if (texte.parseFloat() != NaN) {texte = change(texte);}
        /* visiblement ce n'est pas la bonne methode pour centrer */
        return "<div style='text-align:center'>" + texte + "</div>";
      }
      
      var change = function(val){
        if(val > 2){
          return '<span style="color:red;">' + val + '</span>';
				}else if(val > 1){
					return '<span style="color:green;">' + val + '</span>';
				}
				return val;
			}
  
      var dsp_toInfo = function(val) {
        var t = "<div class='cell_fm'><a class='info_fm' id='info_fm_" + val + "' alt='infos' onclick='LISTE_DES_PRODUITS.popup_prod(" + val + ")'></a></div>";
        return t;
      };

      var ds_s = new Ext.data.Store({
      proxy: new Ext.data.HttpProxy({url:'spip.php?page=liste_des_suggestions'}),
      reader: new Ext.data.JsonReader({
        root: 'liste_des_suggestions'
				}, [
           {name: 'nom'},
           {name: 'nb'},
           {name: 'id_mol'}
        ])
      });
      
      // La grille proprement dite
      this.grid = new Ext.grid.GridPanel({
        store: ds_s,
        columns: [
          {id:'nom',header: SUGG_P, sortable: true, locked:false, dataIndex: 'nom'},
          {header: SUGG_CARD, width: 30, sortable: true, locked:true, dataIndex: 'nb'},
          {header: '(i)', width: 30, sortable: false, locked:true, dataIndex: 'id_mol'}
        ],
        autoExpandColumn:'nom',
        loadMask: {msg:LOAD_MASK},
        viewConfig: {
          forceFit: true
        },
        title: SUGG_GRID_TITLE
      })
              
    }
    
		return this.grid;
  },

  // La mise à jour se fait par json
  show_query : function() {
  	var p1 = jQuery('#p1').val(),
  		p2 = jQuery('#p2').val(), 
  		p3 = jQuery('#p3').val(), 
  		p4 = jQuery('#p4').val(), 
  		p5 = jQuery('#p5').val(),
  		ds_s = this.grid.getStore();
    ds_s.load({params:{'p1':p1,'p2':p2,'p3':p3,'p4':p4,'p5':p5}});
  }
};
Ext.onReady(LISTE_DES_SUGGESTIONS.init, LISTE_DES_SUGGESTIONS);

